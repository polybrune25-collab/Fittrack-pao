<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>FitTrack Pao</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; padding-bottom: 140px; -webkit-font-smoothing: antialiased; }
        .header { background: rgba(255,255,255,0.95); padding: 20px; padding-top: env(safe-area-inset-top, 20px); text-align: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .header h1 { font-size: 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-days { display: flex; overflow-x: auto; background: white; padding: 10px; gap: 8px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .nav-days::-webkit-scrollbar { display: none; }
        .day-btn { flex: 0 0 auto; padding: 12px 20px; border: none; border-radius: 20px; background: #f0f0f0; color: #666; font-weight: 600; font-size: 14px; cursor: pointer; -webkit-appearance: none; appearance: none; }
        .day-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .content { padding: 15px; }
        .day-section { display: none; }
        .day-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .day-title { color: white; font-size: 20px; margin-bottom: 15px; text-align: center; display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; }
        
        .btn-pdf { background: #fff; color: #764ba2; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); -webkit-appearance: none; appearance: none; }
        
        .exercise-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: relative; overflow: hidden; transform: translateZ(0); }
        .exercise-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: #667eea; }
        .exercise-card.activation::before { background: #ffc107; }
        .exercise-card.main::before { background: #28a745; }
        .exercise-card.heavy::before { background: #dc3545; }
        .exercise-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .exercise-name { font-weight: 700; font-size: 16px; flex: 1; padding-right: 10px; }
        .exercise-type { font-size: 10px; padding: 4px 8px; border-radius: 12px; font-weight: 600; text-transform: uppercase; flex-shrink: 0; }
        .type-activation { background: #fff3cd; color: #856404; }
        .type-main { background: #d4edda; color: #155724; }
        .type-heavy { background: #f8d7da; color: #721c24; }
        .exercise-reps { font-size: 13px; color: #666; margin-bottom: 12px; }
        .weight-section { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .weight-input { width: 80px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 18px; font-weight: 700; text-align: center; -webkit-appearance: none; appearance: none; }
        .weight-input:focus { outline: none; border-color: #667eea; }
        .btn-save { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: 700; cursor: pointer; -webkit-appearance: none; appearance: none; min-height: 44px; }
        .btn-save.saved { background: #28a745; }
        .btn-save:disabled { opacity: 0.6; cursor: not-allowed; }
        .history-section { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #e0e0e0; }
        .history-title { font-size: 11px; color: #999; margin-bottom: 5px; text-transform: uppercase; }
        .history-tags { display: flex; gap: 6px; flex-wrap: wrap; }
        .history-tag { background: #f0f0f0; padding: 4px 10px; border-radius: 20px; font-size: 12px; color: #666; }
        .history-tag.recent { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .stats-bar { position: fixed; bottom: 60px; left: 0; right: 0; background: white; padding: 15px; padding-bottom: calc(15px + env(safe-area-inset-bottom, 0px)); display: flex; justify-content: space-around; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); z-index: 100; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 20px; font-weight: 700; color: #667eea; }
        .stat-label { font-size: 10px; color: #999; text-transform: uppercase; }
        .progress-section { background: white; margin: 15px; padding: 15px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .progress-bar { height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 4px; transition: width 0.5s; }
        
        /* Login Modal */
        .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: white; border-radius: 20px; padding: 30px; width: 100%; max-width: 350px; text-align: center; }
        .login-card h2 { margin-bottom: 20px; color: #667eea; }
        .login-input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 16px; margin-bottom: 15px; -webkit-appearance: none; }
        .login-input:focus { outline: none; border-color: #667eea; }
        .btn-login { width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; margin-bottom: 10px; }
        .btn-google { width: 100%; padding: 15px; background: #fff; color: #333; border: 2px solid #e0e0e0; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .login-divider { margin: 20px 0; position: relative; }
        .login-divider::before { content: 'O'; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); background: white; padding: 0 10px; color: #999; font-size: 14px; }
        .login-divider::after { content: ''; position: absolute; left: 0; right: 0; top: 50%; height: 1px; background: #e0e0e0; }
        .user-info { position: absolute; top: 10px; right: 15px; display: flex; align-items: center; gap: 8px; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .btn-logout { background: rgba(255,255,255,0.9); border: none; padding: 5px 10px; border-radius: 8px; font-size: 12px; color: #666; cursor: pointer; }
        .sync-status { position: fixed; top: 80px; right: 15px; background: rgba(255,255,255,0.95); padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; z-index: 99; display: flex; align-items: center; gap: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .sync-status.online { color: #28a745; }
        .sync-status.offline { color: #ffc107; }
        .sync-status.syncing { color: #667eea; }
        
        #installBanner { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; padding-bottom: calc(15px + env(safe-area-inset-bottom, 0px)); z-index: 200; transform: translateY(0); transition: transform 0.3s; }
        #installBanner.hidden { transform: translateY(100%); }
        .banner-content { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .banner-text { flex: 1; font-size: 14px; }
        .banner-text strong { display: block; font-size: 16px; margin-bottom: 3px; }
        .banner-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 20px; cursor: pointer; -webkit-appearance: none; appearance: none; flex-shrink: 0; }
        
        @supports (-webkit-touch-callout: none) {
            .day-btn, .btn-save, .btn-pdf, .banner-close { -webkit-transform: translateZ(0); }
        }
        
        .ios-toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 15px 25px; border-radius: 10px; font-weight: 600; z-index: 1001; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        .ios-toast.show { opacity: 1; }
        
        .loading-spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="login-overlay" style="display: none;">
        <div class="login-card">
            <h2>üí™ FitTrack Pao</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Inicia sesi√≥n para sincronizar tus datos</p>
            
            <button class="btn-google" onclick="signInWithGoogle()">
                <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Continuar con Google
            </button>
            
            <div class="login-divider"></div>
            
            <input type="email" class="login-input" id="emailInput" placeholder="Email">
            <input type="password" class="login-input" id="passwordInput" placeholder="Contrase√±a">
            <button class="btn-login" onclick="signInWithEmail()">Iniciar Sesi√≥n</button>
            <button class="btn-login" onclick="signUpWithEmail()" style="background: #f0f0f0; color: #667eea;">Crear Cuenta</button>
        </div>
    </div>

    <div class="header">
        <div class="user-info" id="userInfo" style="display: none;">
            <div class="user-avatar" id="userAvatar">P</div>
            <button class="btn-logout" onclick="logout()">Salir</button>
        </div>
        <h1>üí™ FitTrack Pao</h1>
        <p>Rutina 5 d√≠as | Inicio: 26/01/26</p>
    </div>
    
    <div class="sync-status offline" id="syncStatus">
        <span id="syncIcon">‚ö†Ô∏è</span>
        <span id="syncText">Sin conexi√≥n</span>
    </div>
    
    <div class="nav-days">
        <button class="day-btn active" data-day="1">D√≠a 1<br><small>Piernas</small></button>
        <button class="day-btn" data-day="2">D√≠a 2<br><small>Espalda</small></button>
        <button class="day-btn" data-day="3">D√≠a 3<br><small>Femoral</small></button>
        <button class="day-btn" data-day="4">D√≠a 4<br><small>Hombros</small></button>
        <button class="day-btn" data-day="5">D√≠a 5<br><small>Gl√∫teos</small></button>
    </div>
    <div class="progress-section">
        <div style="font-size:14px;font-weight:700;margin-bottom:10px;">üìä Progreso Semanal</div>
        <div class="progress-bar"><div class="progress-fill" id="progressBar" style="width:0%"></div></div>
        <div style="text-align:right;font-size:12px;color:#666;margin-top:5px;" id="progressText">0% completado</div>
    </div>
    <div class="content" id="printable-content">
        <div class="day-section active" id="day1">
            <div class="day-title">
                D√≠a 1 - Cu√°driceps 
                <button class="btn-pdf" onclick="downloadPDF('day1', 'Cuadriceps')">üìÑ PDF</button>
            </div>
            <div class="exercise-card activation">
                <div class="exercise-header"><div class="exercise-name">Aductores m√°quina + Estocadas</div><span class="exercise-type type-activation">Activaci√≥n</span></div>
                <div class="exercise-reps">4x15 + 10 estocadas por pierna</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w1-1" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn1-1" onclick="saveWeight('1', '1')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h1-1"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Sill√≥n de Cu√°driceps</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x10 (2s arriba)</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w1-2" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn1-2" onclick="saveWeight('1', '2')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h1-2"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Sentadilla Multipower</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x12,12,10,10</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w1-3" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn1-3" onclick="saveWeight('1', '3')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h1-3"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Prensa 45¬∞</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x15 controlado</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w1-4" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn1-4" onclick="saveWeight('1', '4')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h1-4"></div></div>
            </div>
            <div class="exercise-card heavy">
                <div class="exercise-header"><div class="exercise-name">Estocadas avanzando</div><span class="exercise-type type-heavy">Pesado</span></div>
                <div class="exercise-reps">3x10 por pierna</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w1-5" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn1-5" onclick="saveWeight('1', '5')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h1-5"></div></div>
            </div>
        </div>

        <div class="day-section" id="day2">
            <div class="day-title">
                D√≠a 2 - Espalda y B√≠ceps
                <button class="btn-pdf" onclick="downloadPDF('day2', 'Espalda_Biceps')">üìÑ PDF</button>
            </div>
            <div class="exercise-card activation">
                <div class="exercise-header"><div class="exercise-name">Pullover</div><span class="exercise-type type-activation">Calor</span></div>
                <div class="exercise-reps">4x12,12,10,10</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w2-1" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn2-1" onclick="saveWeight('2', '1')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h2-1"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Jal√≥n al pecho</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x10 + 2 drop sets</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w2-2" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn2-2" onclick="saveWeight('2', '2')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h2-2"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Remo bajo polea</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x12,12,10,8</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w2-3" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn2-3" onclick="saveWeight('2', '3')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h2-3"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Remo 1 brazo</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x10 controlado</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w2-4" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn2-4" onclick="saveWeight('2', '4')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h2-4"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">B√≠ceps martillo</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">3x10 + drop set</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w2-5" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn2-5" onclick="saveWeight('2', '5')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h2-5"></div></div>
            </div>
        </div>

        <div class="day-section" id="day3">
            <div class="day-title">
                D√≠a 3 - Isquios
                <button class="btn-pdf" onclick="downloadPDF('day3', 'Isquios')">üìÑ PDF</button>
            </div>
            <div class="exercise-card activation">
                <div class="exercise-header"><div class="exercise-name">Lumbares en banco</div><span class="exercise-type type-activation">Activaci√≥n</span></div>
                <div class="exercise-reps">4x12 (prioriza gl√∫teos)</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w3-1" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn3-1" onclick="saveWeight('3', '1')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h3-1"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Camilla de isquios</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x15 (2s arriba)</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w3-2" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn3-2" onclick="saveWeight('3', '2')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h3-2"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Peso muerto</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x12 (t√©cnica)</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w3-3" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn3-3" onclick="saveWeight('3', '3')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h3-3"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">H.T / Elevaci√≥n cadera</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">5x15,12,10,8,8</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w3-4" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn3-4" onclick="saveWeight('3', '4')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h3-4"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Sill√≥n femorales</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x12 (2s abajo)</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w3-5" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn3-5" onclick="saveWeight('3', '5')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h3-5"></div></div>
            </div>
        </div>

        <div class="day-section" id="day4">
            <div class="day-title">
                D√≠a 4 - Hombros y Tr√≠ceps
                <button class="btn-pdf" onclick="downloadPDF('day4', 'Hombros_Triceps')">üìÑ PDF</button>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Press mancuernas</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x10</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w4-1" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn4-1" onclick="saveWeight('4', '1')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h4-1"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Vuelos laterales</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x10 + drop sets</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w4-2" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn4-2" onclick="saveWeight('4', '2')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h4-2"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Elevaciones frontales</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">3x15</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w4-3" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn4-3" onclick="saveWeight('4', '3')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h4-3"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Vuelos posteriores</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x12</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w4-4" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn4-4" onclick="saveWeight('4', '4')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h4-4"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Tr√≠ceps polea</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">3x12 + parciales</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w4-5" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn4-5" onclick="saveWeight('4', '5')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h4-5"></div></div>
            </div>
        </div>

        <div class="day-section" id="day5">
            <div class="day-title">
                D√≠a 5 - Gl√∫teos
                <button class="btn-pdf" onclick="downloadPDF('day5', 'Gluteos')">üìÑ PDF</button>
            </div>
            <div class="exercise-card activation">
                <div class="exercise-header"><div class="exercise-name">Abducci√≥n m√°quina</div><span class="exercise-type type-activation">Activaci√≥n</span></div>
                <div class="exercise-reps">4x20+10 cortitas</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w5-1" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn5-1" onclick="saveWeight('5', '1')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h5-1"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">B√∫lgaras</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x10 por pierna</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w5-2" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn5-2" onclick="saveWeight('5', '2')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h5-2"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">H.T / Elevaci√≥n cadera</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">4x12 + parciales</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w5-3" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn5-3" onclick="saveWeight('5', '3')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h5-3"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Sentadilla sumo</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">3x15</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w5-4" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn5-4" onclick="saveWeight('5', '4')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h5-4"></div></div>
            </div>
            <div class="exercise-card main">
                <div class="exercise-header"><div class="exercise-name">Patada gl√∫teos</div><span class="exercise-type type-main">Principal</span></div>
                <div class="exercise-reps">3x12</div>
                <div class="weight-section"><input type="number" class="weight-input" id="w5-5" placeholder="0" inputmode="decimal" pattern="[0-9]*"><span>kg</span><button class="btn-save" id="btn5-5" onclick="saveWeight('5', '5')">üíæ Guardar</button></div>
                <div class="history-section"><div class="history-title">Historial</div><div class="history-tags" id="h5-5"></div></div>
            </div>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><div class="stat-value" id="totalWorkouts">0</div><div class="stat-label">Entrenos</div></div>
        <div class="stat-item"><div class="stat-value" id="totalExercises">0</div><div class="stat-label">Ejercicios</div></div>
        <div class="stat-item"><div class="stat-value" id="lastWeek">-</div><div class="stat-label">√öltimo</div></div>
    </div>

    <div id="installBanner">
        <div class="banner-content">
            <div class="banner-text"><strong>üì± Instalar App</strong>Toca Compartir ‚Üë y "Agregar a Inicio"</div>
            <button class="banner-close" id="closeBanner">‚úï</button>
        </div>
    </div>
    
    <div class="ios-toast" id="iosToast"></div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN FIREBASE - REEMPLAZA CON TUS DATOS
        // ==========================================
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            projectId: "TU_PROYECTO",
            storageBucket: "TU_PROYECTO.appspot.com",
            messagingSenderId: "TU_SENDER_ID",
            appId: "TU_APP_ID"
        };
        
        // Inicializar Firebase
        let db, auth;
        let currentUser = null;
        let localData = {};
        let isOnline = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            isOnline = true;
        } catch(e) {
            console.error('Error inicializando Firebase:', e);
            isOnline = false;
        }
        
        // ==========================================
        // FUNCIONES DE AUTENTICACI√ìN
        // ==========================================
        
        function showLogin() {
            document.getElementById('loginModal').style.display = 'flex';
        }
        
        function hideLogin() {
            document.getElementById('loginModal').style.display = 'none';
        }
        
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(error => {
                showToast('Error: ' + error.message);
            });
        }
        
        function signInWithEmail() {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            
            if (!email || !password) {
                showToast('Ingresa email y contrase√±a');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => {
                    showToast('Error: ' + error.message);
                });
        }
        
        function signUpWithEmail() {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            
            if (!email || !password) {
                showToast('Ingresa email y contrase√±a');
                return;
            }
            
            if (password.length < 6) {
                showToast('La contrase√±a debe tener al menos 6 caracteres');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .catch(error => {
                    showToast('Error: ' + error.message);
                });
        }
        
        function logout() {
            if (confirm('¬øCerrar sesi√≥n? Los datos guardados localmente se mantendr√°n.')) {
                auth.signOut();
            }
        }
        
        // ==========================================
        // SINCRONIZACI√ìN DE DATOS
        // ==========================================
        
        // Cargar datos locales primero
        function loadLocalData() {
            try {
                const stored = localStorage.getItem('fittrackData');
                if (stored) {
                    localData = JSON.parse(stored);
                    renderAllData();
                }
            } catch(e) {
                console.error('Error cargando datos locales:', e);
            }
        }
        
        // Guardar en local y en cloud si est√° logueado
        async function saveWeight(day, ex) {
            const input = document.getElementById('w' + day + '-' + ex);
            const btn = document.getElementById('btn' + day + '-' + ex);
            
            if (!input || !input.value) {
                showToast('Ingresa un peso');
                return;
            }
            
            const weight = parseFloat(input.value);
            if (!weight || weight <= 0 || isNaN(weight)) {
                showToast('Peso inv√°lido');
                return;
            }
            
            const key = day + '-' + ex;
            const date = new Date().toLocaleDateString('es-ES', {day:'2-digit', month:'2-digit'});
            const timestamp = new Date().toISOString();
            
            // Actualizar datos locales
            if (!localData[key]) localData[key] = {history: [], current: 0};
            localData[key].current = weight;
            localData[key].history.unshift({date: date, weight: weight, timestamp: timestamp});
            if (localData[key].history.length > 10) localData[key].history.pop();
            
            // Guardar en localStorage (backup)
            try {
                localStorage.setItem('fittrackData', JSON.stringify(localData));
            } catch(e) {}
            
            // Mostrar en UI
            renderExerciseData(day, ex);
            updateStats();
            
            // Feedback visual
            btn.classList.add('saved');
            btn.textContent = '‚úì Guardado';
            btn.disabled = true;
            
            if (window.navigator && window.navigator.vibrate) {
                try { navigator.vibrate(50); } catch(e) {}
            }
            
            // Sincronizar con Firebase si est√° online y logueado
            if (isOnline && currentUser) {
                updateSyncStatus('syncing', 'Sincronizando...');
                
                try {
                    await db.collection('users').doc(currentUser.uid).collection('exercises').doc(key).set({
                        current: weight,
                        history: localData[key].history,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    updateSyncStatus('online', 'Sincronizado');
                } catch(error) {
                    console.error('Error sincronizando:', error);
                    updateSyncStatus('offline', 'Error de sync');
                    // Guardar para sincronizar despu√©s
                    queueForSync(key, localData[key]);
                }
            } else {
                updateSyncStatus('offline', 'Modo offline');
                showToast('Guardado localmente');
            }
            
            // Restaurar bot√≥n
            setTimeout(() => {
                btn.classList.remove('saved');
                btn.textContent = 'üíæ Guardar';
                btn.disabled = false;
            }, 2000);
        }
        
        function queueForSync(key, data) {
            // Guardar en cola de sincronizaci√≥n pendiente
            let pending = [];
            try {
                const stored = localStorage.getItem('pendingSync');
                if (stored) pending = JSON.parse(stored);
            } catch(e) {}
            
            pending.push({key, data, timestamp: Date.now()});
            localStorage.setItem('pendingSync', JSON.stringify(pending));
        }
        
        // Sincronizar datos pendientes cuando vuelve la conexi√≥n
        async function syncPendingData() {
            if (!currentUser || !isOnline) return;
            
            let pending = [];
            try {
                const stored = localStorage.getItem('pendingSync');
                if (stored) pending = JSON.parse(stored);
            } catch(e) { return; }
            
            if (pending.length === 0) return;
            
            updateSyncStatus('syncing', `Sincronizando ${pending.length}...`);
            
            const batch = db.batch();
            const userRef = db.collection('users').doc(currentUser.uid).collection('exercises');
            
            for (let item of pending) {
                const docRef = userRef.doc(item.key);
                batch.set(docRef, {
                    current: item.data.current,
                    history: item.data.history,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            
            try {
                await batch.commit();
                localStorage.removeItem('pendingSync');
                updateSyncStatus('online', 'Sincronizado');
                showToast(`${pending.length} datos sincronizados`);
            } catch(error) {
                console.error('Error sincronizando pendientes:', error);
                updateSyncStatus('offline', 'Error de sync');
            }
        }
        
        // Escuchar cambios en tiempo real desde Firebase
        function setupRealtimeListener() {
            if (!currentUser || !isOnline) return;
            
            db.collection('users').doc(currentUser.uid).collection('exercises')
                .onSnapshot((snapshot) => {
                    let hasChanges = false;
                    snapshot.forEach((doc) => {
                        const key = doc.id;
                        const data = doc.data();
                        if (data && data.history) {
                            // Merge con datos locales (mantener m√°s reciente)
                            if (!localData[key] || isCloudDataNewer(localData[key], data)) {
                                localData[key] = {
                                    current: data.current,
                                    history: data.history
                                };
                                hasChanges = true;
                            }
                        }
                    });
                    
                    if (hasChanges) {
                        localStorage.setItem('fittrackData', JSON.stringify(localData));
                        renderAllData();
                        updateStats();
                        updateSyncStatus('online', 'Sincronizado');
                    }
                }, (error) => {
                    console.error('Error en listener:', error);
                    updateSyncStatus('offline', 'Sin conexi√≥n');
                });
        }
        
        function isCloudDataNewer(local, cloud) {
            if (!local.history || !cloud.history) return true;
            if (local.history.length === 0) return true;
            if (cloud.history.length === 0) return false;
            
            const localLast = new Date(local.history[0].timestamp || 0);
            const cloudLast = cloud.lastUpdated ? cloud.lastUpdated.toDate() : new Date(0);
            
            return cloudLast > localLast;
        }
        
        // ==========================================
        // RENDERIZADO DE DATOS
        // ==========================================
        
        function renderAllData() {
            for (let day = 1; day <= 5; day++) {
                for (let ex = 1; ex <= 5; ex++) {
                    renderExerciseData(day.toString(), ex.toString());
                }
            }
        }
        
        function renderExerciseData(day, ex) {
            const key = day + '-' + ex;
            const data = localData[key];
            
            if (!data) return;
            
            const input = document.getElementById('w' + day + '-' + ex);
            const histContainer = document.getElementById('h' + day + '-' + ex);
            
            if (input && data.current) {
                input.value = data.current;
            }
            
            if (histContainer && data.history) {
                histContainer.innerHTML = data.history.slice(0, 5).map(function(h, i) {
                    return '<span class="history-tag ' + (i===0?'recent':'') + '">' + h.date + ': ' + h.weight + 'kg</span>';
                }).join('');
            }
        }
        
        function updateStats() {
            const keys = Object.keys(localData);
            const totalExercises = document.getElementById('totalExercises');
            const totalWorkouts = document.getElementById('totalWorkouts');
            const lastWeek = document.getElementById('lastWeek');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            if (totalExercises) totalExercises.textContent = keys.length;
            
            const days = new Set();
            keys.forEach(function(k) { days.add(k.split('-')[0]); });
            if (totalWorkouts) totalWorkouts.textContent = days.size;
            
            let lastDate = null;
            keys.forEach(function(k) { 
                if(localData[k] && localData[k].history && localData[k].history[0]) {
                    lastDate = localData[k].history[0].date;
                }
            });
            if (lastWeek) lastWeek.textContent = lastDate || '-';
            
            const percentage = Math.round((keys.length/25)*100);
            if (progressBar) progressBar.style.width = percentage + '%';
            if (progressText) progressText.textContent = percentage + '% completado';
        }
        
        function updateSyncStatus(status, text) {
            const statusEl = document.getElementById('syncStatus');
            const iconEl = document.getElementById('syncIcon');
            const textEl = document.getElementById('syncText');
            
            statusEl.className = 'sync-status ' + status;
            
            const icons = {
                online: '‚úÖ',
                offline: '‚ö†Ô∏è',
                syncing: '<span class="loading-spinner"></span>'
            };
            
            iconEl.innerHTML = icons[status] || '‚ö†Ô∏è';
            textEl.textContent = text;
        }
        
        // ==========================================
        // UTILIDADES
        // ==========================================
        
        function showToast(message) {
            const toast = document.getElementById('iosToast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }
        
        function downloadPDF(dayId, fileName) {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const element = document.getElementById(dayId);
            
            const opt = {
                margin: 10,
                filename: `FitTrack_Pao_${fileName}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true,
                    logging: false
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            try {
                html2pdf().set(opt).from(element).save().catch(err => {
                    console.error('Error PDF:', err);
                    showToast('Error al generar PDF');
                });
            } catch(e) {
                showToast('Funci√≥n no soportada');
            }
        }
        
        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos locales primero
            loadLocalData();
            
            // Configurar navegaci√≥n
            document.querySelectorAll('.day-btn').forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var day = this.getAttribute('data-day');
                    document.querySelectorAll('.day-btn').forEach(function(b) { b.classList.remove('active'); });
                    document.querySelectorAll('.day-section').forEach(function(s) { s.classList.remove('active'); });
                    this.classList.add('active');
                    var daySection = document.getElementById('day' + day);
                    if (daySection) daySection.classList.add('active');
                });
            });
            
            // Cerrar banner
            const closeBtn = document.getElementById('closeBanner');
            if (closeBtn) {
                closeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('installBanner').classList.add('hidden');
                    localStorage.setItem('bannerClosed', 'true');
                });
            }
            
            if(localStorage.getItem('bannerClosed') === 'true') {
                document.getElementById('installBanner').classList.add('hidden');
            }
            
            // Observador de autenticaci√≥n
            if (auth) {
                auth.onAuthStateChanged(function(user) {
                    if (user) {
                        // Usuario logueado
                        currentUser = user;
                        hideLogin();
                        
                        // Mostrar info de usuario
                        const userInfo = document.getElementById('userInfo');
                        const userAvatar = document.getElementById('userAvatar');
                        if (userInfo) userInfo.style.display = 'flex';
                        if (userAvatar) {
                            const initial = user.displayName ? user.displayName[0].toUpperCase() : 
                                           user.email ? user.email[0].toUpperCase() : 'U';
                            userAvatar.textContent = initial;
                        }
                        
                        // Cargar datos de Firebase y escuchar cambios
                        setupRealtimeListener();
                        syncPendingData();
                        updateSyncStatus('online', 'Conectado');
                    } else {
                        // No logueado
                        currentUser = null;
                        showLogin();
                        document.getElementById('userInfo').style.display = 'none';
                        updateSyncStatus('offline', 'Sin sesi√≥n');
                    }
                });
            } else {
                // Firebase no disponible
                showLogin();
                updateSyncStatus('offline', 'Sin conexi√≥n');
            }
            
            // Detectar cambios de conexi√≥n
            window.addEventListener('online', function() {
                isOnline = true;
                if (currentUser) {
                    updateSyncStatus('online', 'Conectado');
                    syncPendingData();
                }
            });
            
            window.addEventListener('offline', function() {
                isOnline = false;
                updateSyncStatus('offline', 'Sin internet');
            });
        });
    </script>
</body>
</html>
